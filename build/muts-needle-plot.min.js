!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.mutsNeedlePlot=t()}}(function(){var t;return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){var r=t("backbone-events-standalone");r.onAll=function(t,e){return this.on("all",t,e),this},r.oldMixin=r.mixin,r.mixin=function(t){r.oldMixin(t);for(var e=["onAll"],n=0;n<e.length;n++){var o=e[n];t[o]=this[o]}return t},e.exports=r},{"backbone-events-standalone":3}],2:[function(e,n,r){!function(){function e(){return{keys:Object.keys||function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("keys() called on a non-object");var e,n=[];for(e in t)t.hasOwnProperty(e)&&(n[n.length]=e);return n},uniqueId:function(t){var e=++c+"";return t?t+e:e},has:function(t,e){return a.call(t,e)},each:function(t,e,n){if(null!=t)if(s&&t.forEach===s)t.forEach(e,n);else if(t.length===+t.length)for(var r=0,o=t.length;r<o;r++)e.call(n,t[r],r,t);else for(var i in t)this.has(t,i)&&e.call(n,t[i],i,t)},once:function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}}}var o,i=this,s=Array.prototype.forEach,a=Object.prototype.hasOwnProperty,l=Array.prototype.slice,c=0,u=e();o={on:function(t,e,n){if(!d(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!d(this,"once",t,[e,n])||!e)return this;var r=this,o=u.once(function(){r.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,n)},off:function(t,e,n){var r,o,i,s,a,l,c,f;if(!this._events||!d(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(s=t?[t]:u.keys(this._events),a=0,l=s.length;a<l;a++)if(t=s[a],i=this._events[t]){if(this._events[t]=r=[],e||n)for(c=0,f=i.length;c<f;c++)o=i[c],(e&&e!==o.callback&&e!==o.callback._callback||n&&n!==o.context)&&r.push(o);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=l.call(arguments,1);if(!d(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&h(n,e),r&&h(r,arguments),this},stopListening:function(t,e,n){var r=this._listeners;if(!r)return this;var o=!e&&!n;"object"==typeof e&&(n=this),t&&((r={})[t._listenerId]=t);for(var i in r)r[i].off(e,n,this),o&&delete this._listeners[i];return this}};var f=/\s+/,d=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var o in n)t[e].apply(t,[o,n[o]].concat(r));return!1}if(f.test(n)){for(var i=n.split(f),s=0,a=i.length;s<a;s++)t[e].apply(t,[i[s]].concat(r));return!1}return!0},h=function(t,e){var n,r=-1,o=t.length,i=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++r<o;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s);return;case 3:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s,a);return;default:for(;++r<o;)(n=t[r]).callback.apply(n.ctx,e)}},p={listenTo:"on",listenToOnce:"once"};u.each(p,function(t,e){o[e]=function(e,n,r){var o=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return o[i]=e,"object"==typeof n&&(r=this),e[t](n,r,this),this}}),o.bind=o.on,o.unbind=o.off,o.mixin=function(t){var e=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return u.each(e,function(e){t[e]=this[e]},this),t},"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=o),r.BackboneEvents=o):"function"==typeof t&&"object"==typeof t.amd?t(function(){return o}):i.BackboneEvents=o}(this)},{}],3:[function(t,e,n){e.exports=t("./backbone-events-standalone")},{"./backbone-events-standalone":2}],4:[function(e,n,r){!function(e,r){"function"==typeof t&&t.amd?t(["d3"],r):"object"==typeof n&&n.exports?n.exports=function(t){return t.tip=r(t),t.tip}:e.d3.tip=r(e.d3)}(this,function(t){return function(){function e(t){b=p(t),w=b.createSVGPoint(),document.body.appendChild(m)}function n(){return"n"}function r(){return[0,0]}function o(){return" "}function i(){var t=g();return{top:t.n.y-m.offsetHeight,left:t.n.x-m.offsetWidth/2}}function s(){var t=g();return{top:t.s.y,left:t.s.x-m.offsetWidth/2}}function a(){var t=g();return{top:t.e.y-m.offsetHeight/2,left:t.e.x}}function l(){var t=g();return{top:t.w.y-m.offsetHeight/2,left:t.w.x-m.offsetWidth}}function c(){var t=g();return{top:t.nw.y-m.offsetHeight,left:t.nw.x-m.offsetWidth}}function u(){var t=g();return{top:t.ne.y-m.offsetHeight,left:t.ne.x}}function f(){var t=g();return{top:t.sw.y,left:t.sw.x-m.offsetWidth}}function d(){var t=g();return{top:t.se.y,left:t.e.x}}function h(){var e=t.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function p(t){return t=t.node(),"svg"===t.tagName.toLowerCase()?t:t.ownerSVGElement}function g(){for(var e=C||t.event.target;"undefined"==typeof e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var n={},r=e.getScreenCTM(),o=e.getBBox(),i=o.width,s=o.height,a=o.x,l=o.y;return w.x=a,w.y=l,n.nw=w.matrixTransform(r),w.x+=i,n.ne=w.matrixTransform(r),w.y+=s,n.se=w.matrixTransform(r),w.x-=i,n.sw=w.matrixTransform(r),w.y-=s/2,n.w=w.matrixTransform(r),w.x+=i,n.e=w.matrixTransform(r),w.x-=i/2,w.y-=s/2,n.n=w.matrixTransform(r),w.y+=s,n.s=w.matrixTransform(r),n}var y=n,v=r,x=o,m=h(),b=null,w=null,C=null;e.show=function(){var n=Array.prototype.slice.call(arguments);n[n.length-1]instanceof SVGElement&&(C=n.pop());var r,o=x.apply(this,n),i=v.apply(this,n),s=y.apply(this,n),a=t.select(m),l=_.length,c=document.documentElement.scrollTop||document.body.scrollTop,u=document.documentElement.scrollLeft||document.body.scrollLeft;for(a.html(o).style({opacity:1,"pointer-events":"all"});l--;)a.classed(_[l],!1);return r=k.get(s).apply(this),a.classed(s,!0).style({top:r.top+i[0]+c+"px",left:r.left+i[1]+u+"px"}),e},e.hide=function(){var n=t.select(m);return n.style({opacity:0,"pointer-events":"none"}),e},e.attr=function(n,r){if(arguments.length<2&&"string"==typeof n)return t.select(m).attr(n);var o=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(t.select(m),o),e},e.style=function(n,r){if(arguments.length<2&&"string"==typeof n)return t.select(m).style(n);var o=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(t.select(m),o),e},e.direction=function(n){return arguments.length?(y=null==n?n:t.functor(n),e):y},e.offset=function(n){return arguments.length?(v=null==n?n:t.functor(n),e):v},e.html=function(n){return arguments.length?(x=null==n?n:t.functor(n),e):x};var k=t.map({n:i,s:s,e:a,w:l,nw:c,ne:u,sw:f,se:d}),_=k.keys();return e}})},{}],5:[function(t,e,n){function r(e){function n(){var t=C.extent(),e=x.selectAll(".needle-head"),n=[],r={};for(key in Object.keys(s.totalCategCounts))r[key]=0;return e.classed("selected",function(e){return is_brushed=t[0]<=e.coord&&e.coord<=t[1],is_brushed&&(n.push(e),r[e.category]=(r[e.category]||0)+e.value),is_brushed}),{selected:n,categCounts:r,coords:t}}function r(){s.trigger("needleSelectionChange",n())}function i(){s.trigger("needleSelectionChangeEnd",n())}var s=this;if(this.maxCoord=e.maxCoord||-1,this.maxCoord<0)throw new Error("'maxCoord' must be defined initiation config!");this.minCoord=e.minCoord||1;var a=e.mutationData||-1;if(this.maxCoord<0)throw new Error("'mutationData' must be defined initiation config!");var l=e.regionData||-1;if(this.maxCoord<0)throw new Error("'regionData' must be defined initiation config!");this.totalCategCounts={},this.categCounts={},this.selectedNeedles=[];var c=document.getElementById(e.targetElement)||e.targetElement||document.body,u=this.width=e.width||c.offsetWidth||1e3,f=this.height=e.height||c.offsetHeight||500;this.colorMap=e.colorMap||{};var d=Object.keys(this.colorMap).map(function(t){return s.colorMap[t]});this.colorScale=d3.scale.category20().domain(Object.keys(this.colorMap)).range(d.concat(d3.scale.category20().range())),this.legends=e.legends||{y:"Value",x:"Coordinate"},this.svgClasses="mutneedles",this.buffer=0;var h=(this.maxCoord,0);h=u>=f?f/8:u/8,this.buffer=h;var p=t("d3-tip");p(d3);var g=e.needleTip||function(t){return"<span>"+t.value+" "+t.category+" at coord. "+t.coordString+"</span>"},y=e.selectionTip||function(t){return"<span> Selected coordinates<br/>"+Math.round(t.left)+" - "+Math.round(t.right)+"</span>"},v=e.regionTip||function(t){return"<span>"+t.name+"</span>"};this.tip=d3.tip().attr("class","muts-needle-plot d3-tip d3-tip-needle").offset([-10,0]).html(g),this.selectionTip=d3.tip().attr("class","muts-needle-plot d3-tip d3-tip-selection").offset([-50,0]).html(y).direction("n"),this.regionTip=d3.tip().attr("class","muts-needle-plot d3-tip d3-tip-region").offset([-10,0]).html(v).direction("n");var x,m;"resize"==e.responsive?(m=d3.select(c).append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(u)+" "+Math.min(f)).attr("class","brush"),x=m.append("g").attr("class",this.svgClasses).attr("transform","translate(0,0)")):(x=d3.select(c).append("svg").attr("width",u).attr("height",f).attr("class",this.svgClasses+" brush"),m=x),x.call(this.tip),x.call(this.selectionTip),x.call(this.regionTip),this.segments=e.segments;var b;b=e.segments?o(e.segments,.1,h,u):d3.scale.linear().domain([this.minCoord,this.maxCoord]).range([1.5*h,u-h]).nice(),this.x=b;var w=d3.scale.linear().domain([1,20]).range([f-1.5*h,h]).nice();this.y=w,s.selector=d3.svg.brush().x(b).on("brush",r).on("brushend",i);var C=s.selector,k=m.call(C).selectAll(".extent").attr("height",50).attr("y",f-50).attr("opacity",.2);k.on("mouseenter",function(){var t=C.extent();s.selectionTip.show({left:t[0],right:t[1]},k.node())}).on("mouseout",function(){s.selectionTip.style("opacity",0).style("pointer-events","none")}),this.drawNeedles(x,a,l,e.noRegionLabels),s.on("needleSelectionChange",function(t){s.categCounts=t.categCounts,s.selectedNeedles=t.selected,x.call(s.verticalLegend)}),s.on("needleSelectionChangeEnd",function(t){s.categCounts=t.categCounts,s.selectedNeedles=t.selected,x.call(s.verticalLegend)}),s.on("needleSelectionChange",function(t){var e=t.coords;e[1]-e[0]>0?(s.selectionTip.show({left:e[0],right:e[1]},k.node()),s.selectionTip.style("opacity",0).style("pointer-events","none")):s.selectionTip.hide()})}function o(t,e,n,r){t.length<=1&&(e=0);var o=_.map(t,function(t){return t.maxCoord-t.minCoord+1}),i=_.reduce(o,function(t,e){return t.push(t[t.length-1]+e),t},[0]),s=_.map(i,function(t){return t*(1-e)/i[i.length-1]}),a=e/(t.length-1)||0,l=[],c=[];s.forEach(function(e,n){0!==n&&(l.push(t[n-1].minCoord),l.push(t[n-1].maxCoord),c.push((n-1)*a+s[n-1]),c.push((n-1)*a+e))});var u=d3.scale.linear().range([1.5*n,r-n]),f=_.map(c,u);return d3.scale.linear().domain(l).range(f)}r.prototype.drawLegend=function(t){var e,n=this,r=[],o=[],i=Object.keys(n.totalCategCounts),s=n.colorScale.domain();for(e in s){var a=s[e];i.indexOf(a)>-1&&(r.push(a),o.push(n.colorScale(a)))}var l=n.colorScale.domain(r).range(o),c=n.x.domain(),u=.75*(n.x(c[1])-n.x(c[0]))+n.x(c[0]),f=0;for(var a in n.totalCategCounts)f+=n.totalCategCounts[a];var d=function(t){var e=n.categCounts[t]||0==n.selectedNeedles.length&&n.totalCategCounts[t]||0;return t+(e>0?": "+e+" ("+Math.round(e/f*100)+"%)":"")},h=function(t){var e=n.categCounts[t]||0==n.selectedNeedles.length&&n.totalCategCounts[t]||0;return e>0?"":"nomuts"};n.noshow=[];var p=t.selectAll(".needle-head"),g=function(e){_.contains(n.noshow,e)?n.noshow=_.filter(n.noshow,function(t){return t!=e}):n.noshow.push(e),p.classed("noshow",function(t){return _.contains(n.noshow,t.category)});var r=t.selectAll("g.legendCells");r.classed("noshow",function(t){return _.contains(n.noshow,t.stop[0])})},y=d3.svg.legend().labelFormat(d).labelClass(h).onLegendClick(g).cellPadding(4).orientation("vertical").units(f+" Mutations").cellWidth(20).cellHeight(12).inputScale(l).cellStepping(4).place({x:u,y:50});n.verticalLegend=y,t.call(y)},r.prototype.drawRegions=function(t,e,n){function r(e){function r(t){var e=t.radius+3,n=t.x-e,r=t.x+e,o=t.y-e,i=t.y+e;return function(s,a,l,c,u){if(s.point&&s.point!==t){var f=t.x-s.point.x,d=f;e=t.radius+s.point.radius,Math.abs(f)<e&&(f=(f-e)/f*.005,d*=f,d=t.x>s.point.x&&d<0?-d:d,t.x+=d,s.point.x-=d)}return a>r||c<n||l>i||u<o}}var o=t.selectAll().data(["dummy"]).enter().insert("g",":first-child").attr("class","regionsBG").append("rect").attr("x",l(s)).attr("y",a(0)+f).attr("width",l(i)-l(s)).attr("height",10).attr("fill","lightgrey");t.select(".extent").attr("y",a(0)+d-10);var c=o=t.selectAll().data(e).enter().append("g").attr("class","regionGroup");if(c.append("rect").attr("x",function(t){return l(t.start)}).attr("y",a(0)+d).attr("ry","3").attr("rx","3").attr("width",function(t){return l(t.end)-l(t.start)}).attr("height",16).style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}).on("mouseover",function(t){d3.select(this).moveToFront(),u.show(t)}).on("mouseout",u.hide),c.attr("pointer-events","all").attr("cursor","pointer").on("click",function(e){self.selector.extent([e.start,e.end]),self.selector(t.transition()),self.selector(t.transition().delay(300))}),!n){var p=[],g={},y=function(t){var e="regionName",n="RR_"+t.name;return _.has(g,t.name)&&(e="repeatedName noshow "+n),g[t.name]=n,e};c.append("text").attr("class",y).attr("text-anchor","middle").attr("fill","black").attr("opacity",.5).attr("x",function(t){return t.x=l(t.start)+(l(t.end)-l(t.start))/2,t.x}).attr("y",function(t){return t.y=a(0)+h,t.y}).attr("dy","0.35em").style("font-size","12px").style("text-decoration","bold").text(function(t){return t.name});var v=t.selectAll(".regionName");v.each(function(t,e){var n=this.getBBox().width/2;p.push({x:t.x,y:t.y,label:t.name,weight:t.name.length,radius:n})});var x=d3.layout.force().chargeDistance(5).nodes(p).charge(-10).gravity(0),m=(l(s),l(i),function(e,n){var r=g[e];t.selectAll("text."+r).attr("x",newx)});x.on("tick",function(e){for(var n=d3.geom.quadtree(p),o=0,i=p.length;++o<i;)n.visit(r(p[o]));var o=0;t.selectAll("text.regionName").attr("x",function(t){return newx=p[o++].x,m(t.name,newx),newx})}),x.start()}}function o(t){for(key in Object.keys(t))t[key].start=getRegionStart(t[key].coord),t[key].end=getRegionEnd(t[key].coord),t[key].start==t[key].end&&(t[key].start-=.4,t[key].end+=.4),t[key].color=getColor(t[key].name);return t}var i=this.maxCoord,s=this.minCoord,a=(this.buffer,this.colorMap,this.y),l=this.x,c=!0,u=this.regionTip;getRegionStart=function(t){return parseInt(t.split("-")[0])},getRegionEnd=function(t){return parseInt(t.split("-")[1])},getColor=this.colorScale;var f=0,d=f-3,h=f+20;1!=c&&(h=f+5),"string"==typeof e?d3.json(e,function(t,e){return t?console.debug(t):(regionList=o(e),void r(regionList))}):(regionList=o(e),r(regionList))},r.prototype.drawAxes=function(t){var e=this.y,n=this.x;xAxis=d3.svg.axis().scale(n).orient("bottom"),this.segments&&xAxis.tickValues(_.map(d3.scale.linear().domain([n(this.minCoord),n(this.maxCoord)]).ticks(6),function(t){return Math.round(n.invert(t))})),t.append("svg:g").attr("class","x-axis axis").attr("transform","translate(0,"+(this.height-this.buffer)+")").call(xAxis),yAxis=d3.svg.axis().scale(e).orient("left"),t.append("svg:g").attr("class","y-axis axis").attr("transform","translate("+(1.2*this.buffer+-10)+",0)").call(yAxis),t.selectAll(".axis path").attr("fill","none"),t.selectAll(".domain").attr("stroke","black").attr("stroke-width",1),t.append("text").attr("class","y-label").attr("text-anchor","middle").attr("transform","translate("+this.buffer/3+","+this.height/2+"), rotate(-90)").text(this.legends.y).attr("font-weight","bold").attr("font-size",12),t.append("text").attr("class","x-label").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-this.buffer/3)+")").text(this.legends.x).attr("font-weight","bold").attr("font-size",12)},r.prototype.drawNeedles=function(t,e,n,r){function o(t){var e=t.coord,n=d(t.coord),r=Number(t.value),o=y(n,r,p),i=t.category||"other";return o+r>g&&(g=o+r,f().domain([0,g+2])),n>0?(u.totalCategCounts[i]=(u.totalCategCounts[i]||0)+r,{category:i,coordString:e,coord:n,value:r,stickHeight:o,color:u.colorScale(i),data:t.data}):void console.debug("discarding "+t.coord+" "+t.category+"("+n+")")}function i(t){var e,n=[];for(e in t){var r=o(t[e]);void 0!=r&&n.push(r)}return n}function s(e){var o=4,i=10,s=d3.scale.log().range([o,i]).domain([1,g/2]),a=function(t){return d3.min([d3.max([s(t),o]),i])},f=(t.selectAll().data(e).enter().append("line").attr("y1",function(t){return l(t.stickHeight+t.value)+a(t.value)}).attr("y2",function(t){return l(t.stickHeight)}).attr("x1",function(t){return c(t.coord)}).attr("x2",function(t){return c(t.coord)}).attr("class","needle-line").attr("stroke","black").attr("stroke-width",1),t.selectAll().data(e).enter().append("circle").attr("cy",function(t){return l(t.stickHeight+t.value)}).attr("cx",function(t){return c(t.coord)}).attr("r",function(t){return a(t.value)}).attr("class","needle-head").style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}).on("mouseover",function(t){d3.select(this).moveToFront(),h.show(t)}).on("mouseout",h.hide));d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},void 0!=n&&u.drawRegions(t,n,r),u.drawLegend(t),u.drawAxes(t),f.each(function(){this.parentNode.appendChild(this)})}var a,l=this.y,c=this.x,u=this,f=function(){return l},d=function(t){return t.indexOf("-")>-1?(coords=t.split("-"),t=Math.floor((parseInt(coords[0])+parseInt(coords[1]))/2),isNaN(t)&&("?"==coords[0]?t=parseInt(coords[1]):"?"==coords[1]&&(t=parseInt(coords[0])))):t=parseInt(t),t},h=this.tip,p={},g=0,y=function(t,e,n){var r=0;return t="p"+String(t),t in n?(r=n[t],newHeight=r+e,n[t]=newHeight):n[t]=e,r};"string"==typeof e?d3.json(e,function(t,e){if(t)throw new Error(t);a=i(e),s(a)}):(a=i(e),s(a))};var i=t("biojs-events");i.mixin(r.prototype),e.exports=r},{"biojs-events":1,"d3-tip":4}],"muts-needle-plot":[function(t,e,n){e.exports=t("./src/js/MutsNeedlePlot.js")},{"./src/js/MutsNeedlePlot.js":5}]},{},["muts-needle-plot"])("muts-needle-plot")});