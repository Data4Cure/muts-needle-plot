!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.mutsNeedlePlot=t()}}(function(){var t;return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return o(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){var r=t("backbone-events-standalone");r.onAll=function(t,e){return this.on("all",t,e),this},r.oldMixin=r.mixin,r.mixin=function(t){r.oldMixin(t);for(var e=["onAll"],n=0;n<e.length;n++){var o=e[n];t[o]=this[o]}return t},e.exports=r},{"backbone-events-standalone":3}],2:[function(e,n,r){!function(){function e(){return{keys:Object.keys||function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("keys() called on a non-object");var e,n=[];for(e in t)t.hasOwnProperty(e)&&(n[n.length]=e);return n},uniqueId:function(t){var e=++c+"";return t?t+e:e},has:function(t,e){return s.call(t,e)},each:function(t,e,n){if(null!=t)if(a&&t.forEach===a)t.forEach(e,n);else if(t.length===+t.length)for(var r=0,o=t.length;r<o;r++)e.call(n,t[r],r,t);else for(var i in t)this.has(t,i)&&e.call(n,t[i],i,t)},once:function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}}}var o,i=this,a=Array.prototype.forEach,s=Object.prototype.hasOwnProperty,l=Array.prototype.slice,c=0,u=e();o={on:function(t,e,n){if(!d(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!d(this,"once",t,[e,n])||!e)return this;var r=this,o=u.once(function(){r.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,n)},off:function(t,e,n){var r,o,i,a,s,l,c,f;if(!this._events||!d(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(a=t?[t]:u.keys(this._events),s=0,l=a.length;s<l;s++)if(t=a[s],i=this._events[t]){if(this._events[t]=r=[],e||n)for(c=0,f=i.length;c<f;c++)o=i[c],(e&&e!==o.callback&&e!==o.callback._callback||n&&n!==o.context)&&r.push(o);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=l.call(arguments,1);if(!d(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&h(n,e),r&&h(r,arguments),this},stopListening:function(t,e,n){var r=this._listeners;if(!r)return this;var o=!e&&!n;"object"==typeof e&&(n=this),t&&((r={})[t._listenerId]=t);for(var i in r)r[i].off(e,n,this),o&&delete this._listeners[i];return this}};var f=/\s+/,d=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var o in n)t[e].apply(t,[o,n[o]].concat(r));return!1}if(f.test(n)){for(var i=n.split(f),a=0,s=i.length;a<s;a++)t[e].apply(t,[i[a]].concat(r));return!1}return!0},h=function(t,e){var n,r=-1,o=t.length,i=e[0],a=e[1],s=e[2];switch(e.length){case 0:for(;++r<o;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,a);return;case 3:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,a,s);return;default:for(;++r<o;)(n=t[r]).callback.apply(n.ctx,e)}},p={listenTo:"on",listenToOnce:"once"};u.each(p,function(t,e){o[e]=function(e,n,r){var o=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return o[i]=e,"object"==typeof n&&(r=this),e[t](n,r,this),this}}),o.bind=o.on,o.unbind=o.off,o.mixin=function(t){var e=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return u.each(e,function(e){t[e]=this[e]},this),t},"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=o),r.BackboneEvents=o):"function"==typeof t&&"object"==typeof t.amd?t(function(){return o}):i.BackboneEvents=o}(this)},{}],3:[function(t,e,n){e.exports=t("./backbone-events-standalone")},{"./backbone-events-standalone":2}],4:[function(e,n,r){!function(e,r){"function"==typeof t&&t.amd?t(["d3"],r):"object"==typeof n&&n.exports?n.exports=function(t){return t.tip=r(t),t.tip}:e.d3.tip=r(e.d3)}(this,function(t){return function(){function e(t){b=p(t),w=b.createSVGPoint(),document.body.appendChild(m)}function n(){return"n"}function r(){return[0,0]}function o(){return" "}function i(){var t=g();return{top:t.n.y-m.offsetHeight,left:t.n.x-m.offsetWidth/2}}function a(){var t=g();return{top:t.s.y,left:t.s.x-m.offsetWidth/2}}function s(){var t=g();return{top:t.e.y-m.offsetHeight/2,left:t.e.x}}function l(){var t=g();return{top:t.w.y-m.offsetHeight/2,left:t.w.x-m.offsetWidth}}function c(){var t=g();return{top:t.nw.y-m.offsetHeight,left:t.nw.x-m.offsetWidth}}function u(){var t=g();return{top:t.ne.y-m.offsetHeight,left:t.ne.x}}function f(){var t=g();return{top:t.sw.y,left:t.sw.x-m.offsetWidth}}function d(){var t=g();return{top:t.se.y,left:t.e.x}}function h(){var e=t.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function p(t){return t=t.node(),"svg"===t.tagName.toLowerCase()?t:t.ownerSVGElement}function g(){for(var e=C||t.event.target;"undefined"==typeof e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var n={},r=e.getScreenCTM(),o=e.getBBox(),i=o.width,a=o.height,s=o.x,l=o.y;return w.x=s,w.y=l,n.nw=w.matrixTransform(r),w.x+=i,n.ne=w.matrixTransform(r),w.y+=a,n.se=w.matrixTransform(r),w.x-=i,n.sw=w.matrixTransform(r),w.y-=a/2,n.w=w.matrixTransform(r),w.x+=i,n.e=w.matrixTransform(r),w.x-=i/2,w.y-=a/2,n.n=w.matrixTransform(r),w.y+=a,n.s=w.matrixTransform(r),n}var y=n,v=r,x=o,m=h(),b=null,w=null,C=null;e.show=function(){var n=Array.prototype.slice.call(arguments);n[n.length-1]instanceof SVGElement&&(C=n.pop());var r,o=x.apply(this,n),i=v.apply(this,n),a=y.apply(this,n),s=t.select(m),l=_.length,c=document.documentElement.scrollTop||document.body.scrollTop,u=document.documentElement.scrollLeft||document.body.scrollLeft;for(s.html(o).style({opacity:1,"pointer-events":"all"});l--;)s.classed(_[l],!1);return r=k.get(a).apply(this),s.classed(a,!0).style({top:r.top+i[0]+c+"px",left:r.left+i[1]+u+"px"}),e},e.hide=function(){var n=t.select(m);return n.style({opacity:0,"pointer-events":"none"}),e},e.attr=function(n,r){if(arguments.length<2&&"string"==typeof n)return t.select(m).attr(n);var o=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(t.select(m),o),e},e.style=function(n,r){if(arguments.length<2&&"string"==typeof n)return t.select(m).style(n);var o=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(t.select(m),o),e},e.direction=function(n){return arguments.length?(y=null==n?n:t.functor(n),e):y},e.offset=function(n){return arguments.length?(v=null==n?n:t.functor(n),e):v},e.html=function(n){return arguments.length?(x=null==n?n:t.functor(n),e):x};var k=t.map({n:i,s:a,e:s,w:l,nw:c,ne:u,sw:f,se:d}),_=k.keys();return e}})},{}],5:[function(t,e,n){function r(e){function n(){var t=b.extent(),e=y.selectAll(".needle-head"),n=[],r={};for(key in Object.keys(i.totalCategCounts))r[key]=0;return e.classed("selected",function(e){return is_brushed=t[0]<=e.coord&&e.coord<=t[1],is_brushed&&(n.push(e),r[e.category]=(r[e.category]||0)+e.value),is_brushed}),{selected:n,categCounts:r,coords:t}}function r(){i.trigger("needleSelectionChange",n())}function o(){i.trigger("needleSelectionChangeEnd",n())}var i=this;if(this.maxCoord=e.maxCoord||-1,this.maxCoord<0)throw new Error("'maxCoord' must be defined initiation config!");this.minCoord=e.minCoord||1;var a=e.mutationData||-1;if(this.maxCoord<0)throw new Error("'mutationData' must be defined initiation config!");var s=e.regionData||-1;if(this.maxCoord<0)throw new Error("'regionData' must be defined initiation config!");this.totalCategCounts={},this.categCounts={},this.selectedNeedles=[];var l=document.getElementById(e.targetElement)||e.targetElement||document.body,c=this.width=e.width||l.offsetWidth||1e3,u=this.height=e.height||l.offsetHeight||500;this.colorMap=e.colorMap||{};var f=Object.keys(this.colorMap).map(function(t){return i.colorMap[t]});this.colorScale=d3.scale.category20().domain(Object.keys(this.colorMap)).range(f.concat(d3.scale.category20().range())),this.legends=e.legends||{y:"Value",x:"Coordinate"},this.svgClasses="mutneedles",this.buffer=0;var d=(this.maxCoord,0);d=c>=u?u/8:c/8,this.buffer=d;var h=t("d3-tip");h(d3);var p=e.needleTip||function(t){return"<span>"+t.value+" "+t.category+" at coord. "+t.coordString+"</span>"},g=e.selectionTip||function(t){return"<span> Selected coordinates<br/>"+Math.round(t.left)+" - "+Math.round(t.right)+"</span>"};this.tip=d3.tip().attr("class","d3-tip d3-tip-needle").offset([-10,0]).html(p),this.selectionTip=d3.tip().attr("class","d3-tip d3-tip-selection").offset([-50,0]).html(g).direction("n");var y,v;"resize"==e.responsive?(v=d3.select(l).append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(c)+" "+Math.min(u)).attr("class","brush"),y=v.append("g").attr("class",this.svgClasses).attr("transform","translate(0,0)")):(y=d3.select(l).append("svg").attr("width",c).attr("height",u).attr("class",this.svgClasses+" brush"),v=y),y.call(this.tip),y.call(this.selectionTip);var x=d3.scale.linear().domain([this.minCoord,this.maxCoord]).range([1.5*d,c-d]).nice();this.x=x;var m=d3.scale.linear().domain([1,20]).range([u-1.5*d,d]).nice();this.y=m,i.selector=d3.svg.brush().x(x).on("brush",r).on("brushend",o);var b=i.selector,w=v.call(b).selectAll(".extent").attr("height",50).attr("y",u-50).attr("opacity",.2);w.on("mouseenter",function(){var t=b.extent();i.selectionTip.show({left:t[0],right:t[1]},w.node())}).on("mouseout",function(){i.selectionTip.style("opacity",0).style("pointer-events","none")}),this.drawNeedles(y,a,s),i.on("needleSelectionChange",function(t){i.categCounts=t.categCounts,i.selectedNeedles=t.selected,y.call(i.verticalLegend)}),i.on("needleSelectionChangeEnd",function(t){i.categCounts=t.categCounts,i.selectedNeedles=t.selected,y.call(i.verticalLegend)}),i.on("needleSelectionChange",function(t){var e=t.coords;e[1]-e[0]>0?(i.selectionTip.show({left:e[0],right:e[1]},w.node()),i.selectionTip.style("opacity",0).style("pointer-events","none")):i.selectionTip.hide()})}r.prototype.drawLegend=function(t){var e,n=this,r=[],o=[],i=Object.keys(n.totalCategCounts),a=n.colorScale.domain();for(e in a){var s=a[e];i.indexOf(s)>-1&&(r.push(s),o.push(n.colorScale(s)))}var l=n.colorScale.domain(r).range(o),c=n.x.domain(),u=.75*(n.x(c[1])-n.x(c[0]))+n.x(c[0]),f=0;for(var s in n.totalCategCounts)f+=n.totalCategCounts[s];var d=function(t){var e=n.categCounts[t]||0==n.selectedNeedles.length&&n.totalCategCounts[t]||0;return t+(e>0?": "+e+" ("+Math.round(e/f*100)+"%)":"")},h=function(t){var e=n.categCounts[t]||0==n.selectedNeedles.length&&n.totalCategCounts[t]||0;return e>0?"":"nomuts"};n.noshow=[];var p=t.selectAll(".needle-head"),g=function(e){_.contains(n.noshow,e)?n.noshow=_.filter(n.noshow,function(t){return t!=e}):n.noshow.push(e),p.classed("noshow",function(t){return _.contains(n.noshow,t.category)});var r=t.selectAll("g.legendCells");r.classed("noshow",function(t){return _.contains(n.noshow,t.stop[0])})},y=d3.svg.legend().labelFormat(d).labelClass(h).onLegendClick(g).cellPadding(4).orientation("vertical").units(f+" Mutations").cellWidth(20).cellHeight(12).inputScale(l).cellStepping(4).place({x:u,y:50});n.verticalLegend=y,t.call(y)},r.prototype.drawRegions=function(t,e){function n(e){function n(t){var e=t.radius+3,n=t.x-e,r=t.x+e,o=t.y-e,i=t.y+e;return function(a,s,l,c,u){if(a.point&&a.point!==t){var f=t.x-a.point.x,d=f;e=t.radius+a.point.radius,Math.abs(f)<e&&(f=(f-e)/f*.005,d*=f,d=t.x>a.point.x&&d<0?-d:d,t.x+=d,a.point.x-=d)}return s>r||c<n||l>i||u<o}}var r=t.selectAll().data(["dummy"]).enter().insert("g",":first-child").attr("class","regionsBG").append("rect").attr("x",s(i)).attr("y",a(0)+c).attr("width",s(o)-s(i)).attr("height",10).attr("fill","lightgrey");t.select(".extent").attr("y",a(0)+u-10);var l=r=t.selectAll().data(e).enter().append("g").attr("class","regionGroup");l.append("rect").attr("x",function(t){return s(t.start)}).attr("y",a(0)+u).attr("ry","3").attr("rx","3").attr("width",function(t){return s(t.end)-s(t.start)}).attr("height",16).style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}),l.attr("pointer-events","all").attr("cursor","pointer").on("click",function(e){self.selector.extent([e.start,e.end]),self.selector(t.transition()),self.selector(t.transition().delay(300))});var d=[],h={},p=function(t){var e="regionName",n="RR_"+t.name;return _.has(h,t.name)&&(e="repeatedName noshow "+n),h[t.name]=n,e};l.append("text").attr("class",p).attr("text-anchor","middle").attr("fill","black").attr("opacity",.5).attr("x",function(t){return t.x=s(t.start)+(s(t.end)-s(t.start))/2,t.x}).attr("y",function(t){return t.y=a(0)+f,t.y}).attr("dy","0.35em").style("font-size","12px").style("text-decoration","bold").text(function(t){return t.name});var g=t.selectAll(".regionName");g.each(function(t,e){var n=this.getBBox().width/2;d.push({x:t.x,y:t.y,label:t.name,weight:t.name.length,radius:n})});var y=d3.layout.force().chargeDistance(5).nodes(d).charge(-10).gravity(0),v=(s(i),s(o),function(e,n){var r=h[e];t.selectAll("text."+r).attr("x",newx)});y.on("tick",function(e){for(var r=d3.geom.quadtree(d),o=0,i=d.length;++o<i;)r.visit(n(d[o]));var o=0;t.selectAll("text.regionName").attr("x",function(t){return newx=d[o++].x,v(t.name,newx),newx})}),y.start()}function r(t){for(key in Object.keys(t))t[key].start=getRegionStart(t[key].coord),t[key].end=getRegionEnd(t[key].coord),t[key].start==t[key].end&&(t[key].start-=.4,t[key].end+=.4),t[key].color=getColor(t[key].name);return t}var o=this.maxCoord,i=this.minCoord,a=(this.buffer,this.colorMap,this.y),s=this.x,l=!0;getRegionStart=function(t){return parseInt(t.split("-")[0])},getRegionEnd=function(t){return parseInt(t.split("-")[1])},getColor=this.colorScale;var c=0,u=c-3,f=c+20;1!=l&&(f=c+5),"string"==typeof e?d3.json(e,function(t,e){return t?console.debug(t):(regionList=r(e),void n(regionList))}):(regionList=r(e),n(regionList))},r.prototype.drawAxes=function(t){var e=this.y,n=this.x;xAxis=d3.svg.axis().scale(n).orient("bottom"),t.append("svg:g").attr("class","x-axis axis").attr("transform","translate(0,"+(this.height-this.buffer)+")").call(xAxis),yAxis=d3.svg.axis().scale(e).orient("left"),t.append("svg:g").attr("class","y-axis axis").attr("transform","translate("+(1.2*this.buffer+-10)+",0)").call(yAxis),t.selectAll(".axis path").attr("fill","none"),t.selectAll(".domain").attr("stroke","black").attr("stroke-width",1),t.append("text").attr("class","y-label").attr("text-anchor","middle").attr("transform","translate("+this.buffer/3+","+this.height/2+"), rotate(-90)").text(this.legends.y).attr("font-weight","bold").attr("font-size",12),t.append("text").attr("class","x-label").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-this.buffer/3)+")").text(this.legends.x).attr("font-weight","bold").attr("font-size",12)},r.prototype.drawNeedles=function(t,e,n){function r(t){var e=t.coord,n=f(t.coord),r=Number(t.value),o=g(n,r,h),i=t.category||"other";return o+r>p&&(p=o+r,u().domain([0,p+2])),n>0?(c.totalCategCounts[i]=(c.totalCategCounts[i]||0)+r,{category:i,coordString:e,coord:n,value:r,stickHeight:o,color:c.colorScale(i),data:t.data}):void console.debug("discarding "+t.coord+" "+t.category+"("+n+")")}function o(t){var e,n=[];for(e in t){var o=r(t[e]);void 0!=o&&n.push(o)}return n}function i(e){var r=4,o=10,i=d3.scale.log().range([r,o]).domain([1,p/2]),a=function(t){return d3.min([d3.max([i(t),r]),o])},u=(t.selectAll().data(e).enter().append("line").attr("y1",function(t){return s(t.stickHeight+t.value)+a(t.value)}).attr("y2",function(t){return s(t.stickHeight)}).attr("x1",function(t){return l(t.coord)}).attr("x2",function(t){return l(t.coord)}).attr("class","needle-line").attr("stroke","black").attr("stroke-width",1),t.selectAll().data(e).enter().append("circle").attr("cy",function(t){return s(t.stickHeight+t.value)}).attr("cx",function(t){return l(t.coord)}).attr("r",function(t){return a(t.value)}).attr("class","needle-head").style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}).on("mouseover",function(t){d3.select(this).moveToFront(),d.show(t)}).on("mouseout",d.hide));d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},void 0!=n&&c.drawRegions(t,n),c.drawLegend(t),c.drawAxes(t),u.each(function(){this.parentNode.appendChild(this)})}var a,s=this.y,l=this.x,c=this,u=function(){return s},f=function(t){return t.indexOf("-")>-1?(coords=t.split("-"),t=Math.floor((parseInt(coords[0])+parseInt(coords[1]))/2),isNaN(t)&&("?"==coords[0]?t=parseInt(coords[1]):"?"==coords[1]&&(t=parseInt(coords[0])))):t=parseInt(t),t},d=this.tip,h={},p=0,g=function(t,e,n){var r=0;return t="p"+String(t),t in n?(r=n[t],newHeight=r+e,n[t]=newHeight):n[t]=e,r};"string"==typeof e?d3.json(e,function(t,e){if(t)throw new Error(t);a=o(e),i(a)}):(a=o(e),i(a))};var o=t("biojs-events");o.mixin(r.prototype),e.exports=r},{"biojs-events":1,"d3-tip":4}],"muts-needle-plot":[function(t,e,n){e.exports=t("./src/js/MutsNeedlePlot.js")},{"./src/js/MutsNeedlePlot.js":5}]},{},["muts-needle-plot"])("muts-needle-plot")});